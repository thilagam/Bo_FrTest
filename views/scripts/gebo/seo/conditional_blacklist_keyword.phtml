<div class="span10">

    <h3 class="heading">Blacklist Keyword Finder</h3>
    {if $msg neq ''}
    <div class="alert alert-{$class}" id="seo-message" style="disply:block;width:800px;">
        <div class="row-fluid">
            <div class="span12 form-inline">
                {$msg}
            </div>
        </div>
    </div>
    {/if}
        <div class="control-group formSep" id="seotool-notify">
            <div class="row-fluid">
                <div class="span12 form-inline">
                    <div id="seo-message">
                        {$msg}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="control-group formSep">
            <div class="row-fluid">
                <div class="span12 form-inline">
                    <label class="span3"><span class="error_placement">Clients</span></label>
                    <select name="clientblkws1" id="clientblkws1" class="chzn_c" onchange="return loadblkws(this.value, '1');">
                        <option value="">s&#233;lectionner</option>
                        <option value="cch">CCH</option>
                        <option value="bnb">BNB</option>
                        <option value="sct">SCT</option>
                        <option value="les_furets">LES FURETS</option>
                        <option value="orange.com">ORANGE.COM</option>
                        <option value="celio">CELIO</option>
                        <option value="caroll">CAROLL</option>
                        <option value="armand_thiery_desc">ARMAND THIERY DESC</option>
                        <option value="ptt_fr">PTT FR</option>
                        <option value="meetic">MEETIC</option>
                        <option value="lbm">LBM</option>
                        <option value="cdc_fr">CDC FR</option>
                        <option value="san_marina">SAN MARINA</option>
                        <option value="morgan">Morgan</option>
                        <option value="cosmoparis">COSMOPARIS</option>
                    </select>
                </div>
            </div>
        </div>
            
        <form method="POST" action="/seotool/cond-keyword-xls-upload" name="condkwupload" class="form_validation_reg"  enctype="multipart/form-data" id="seo">
            <div class="control-group formSep">
                <div class="row-fluid">
                    <div class="control-group">
                        <label class="span3 control-label">Predefined blacklist keywords</label>
                        <div class="span8 controls no-margin-first">
                            <textarea name="kw1" id="txtarea_sp1" cols="1" rows="4" class="span10"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="control-group formSep" id="csv">
                <div class="row-fluid">
                    <div class="span12 form-inline">
                        <label class="span3">Excel file<span class="f_req">*</span></label>
    
                        <div data-provides="fileupload" class="fileupload fileupload-new">
                            <input type="hidden" />
                            <div data-provides="fileupload" class="fileupload fileupload-new">
                                <input type="hidden" />
                                <div class="input-append">
                                    <div class="uneditable-input span2">
                                        <i class="icon-file fileupload-exists"></i><span class="fileupload-preview"></span>
                                    </div><span class="btn btn-file"><span class="fileupload-new">Select file</span><span class="fileupload-exists">Change</span>
                                        <input name="keyword_file1" id="keyword_file1" type="file" />
                                    </span><a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="control-group formSep">
                <div class="row-fluid" id="mkw">
    
        <div class="span12 form-inline" id="mkwRow1">
    		<label class="span3" id="mkw_label">Main Keyword</label>
    		<div class="span3 no-margin-first" id="mkw_select">
    		    <select name="main_kw_ref[]" id="main_kw_ref1" class="chzn_d" style="width:70px;"><option value="1" selected>A</option><option value="2">B</option><option value="3">C</option><option value="4">D</option><option value="5">E</option><option value="6">F</option><option value="7">G</option><option value="8">H</option><option value="9">I</option><option value="10">J</option><option value="11">K</option><option value="12">L</option><option value="13">M</option><option value="14">N</option><option value="15">O</option><option value="16">P</option><option value="17">Q</option><option value="18">R</option><option value="19">S</option><option value="20">T</option><option value="21">U</option><option value="22">V</option><option value="23">W</option><option value="24">X</option><option value="25">Y</option><option value="26">Z</option></select>
    		</div>
    		<div class="col-kw">
    		    <input type="text" name="main_kw[]" class="span3"/>
    		    <span id="colkw1">
    		      <span id="addmore_mkv" class="addmore-button"><a class="btn" onclick="addMainKwref(1)"><i class="icon-plus"></i></a></span>
    		    </span>
    		</div>
        </div>
    
                </div>
            </div>
            <div class="control-group formSep">
                <div class="row-fluid" id="mcond">
    
        <div class="span12 form-inline" id="mcondRow1">
            <label class="span3" id="mcond_label">Condition</label>
            <div class="span3 no-margin-first" id="mcond_select">
                <select name="main_cond_ref[]" id="main_cond_ref1" class="chzn_e" style="width:70px;"><option value="1">A</option><option value="2">B</option><option value="3" selected>C</option><option value="4">D</option><option value="5">E</option><option value="6">F</option><option value="7">G</option><option value="8">H</option><option value="9">I</option><option value="10">J</option><option value="11">K</option><option value="12">L</option><option value="13">M</option><option value="14">N</option><option value="15">O</option><option value="16">P</option><option value="17">Q</option><option value="18">R</option><option value="19">S</option><option value="20">T</option><option value="21">U</option><option value="22">V</option><option value="23">W</option><option value="24">X</option><option value="25">Y</option><option value="26">Z</option></select>
                <select name="condn[]" id="slcondn1" style="width:130px;" class="chzn_f"><option value="1" selected>Should contain</option><option value="2">Should not contain</option></select>
            </div>
            <div class="col-cond">
                <input type="text" name="main_cond[]" class="span3"/>
                <span id="colcond1"></span>
            </div>
        </div>
    
        <div class="span12 form-inline" id="mcondRow2">
            <label class="span3" id="mcond_label"></label>
            <div class="span3 no-margin-first" id="mcond_select">
                <select name="main_cond_ref[]" id="main_cond_ref2" class="chzn_e" style="width:70px;"><option value="1">A</option><option value="2">B</option><option value="3">C</option><option value="4" selected>D</option><option value="5">E</option><option value="6">F</option><option value="7">G</option><option value="8">H</option><option value="9">I</option><option value="10">J</option><option value="11">K</option><option value="12">L</option><option value="13">M</option><option value="14">N</option><option value="15">O</option><option value="16">P</option><option value="17">Q</option><option value="18">R</option><option value="19">S</option><option value="20">T</option><option value="21">U</option><option value="22">V</option><option value="23">W</option><option value="24">X</option><option value="25">Y</option><option value="26">Z</option></select>
                <select name="condn[]" id="slcondn2" style="width:130px;" class="chzn_f"><option value="1">Should contain</option><option value="2" selected>Should not contain</option></select>
            </div>
            <div class="col-cond">
                <input type="text" name="main_cond[]" class="span3"/>
                <span id="colcond2">
                    <span id="addmore_mcv" class="addmore-button"><a class="btn" onclick="addCondKwref(2)"><i class="icon-plus"></i></a></span>
                    <span id="rmv_mcv" class="addmore-button"><a class="btn" onclick="rmvCondKwref(2)"><i class="icon-minus"></i></a></span>
                </span>
            </div>
        </div>
                </div>
            </div>
            <div class="control-group formSep">
                <div class="row-fluid">
                    <div class="span12 form-inline">
                        <label class="span3">Match</label>
                        <label class="uni-radio"><input type="radio" name="match_type" class="uni_style"  value="1">Partial</label>
                        <label class="uni-radio"><input type="radio" name="match_type" class="uni_style"  value="2" checked>Exact</label>
                    </div>
                </div>
            </div>
            <div class="control-group">
                <div class="row-fluid">
                    <div class="span12 form-inline">
    	<input type="hidden" name="conditional" value="1" />
                        <button class="btn btn-gebo" name="submit" type="submit" value="Upload">
                            Upload
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div id="data"></div>
</div>
</form>

{literal}
<script type="text/javascript">

function addMainKwref(idx)
{
    idx = parseInt(idx);
    $('span#colkw'+idx).html('');

    $('#mkw').append('<div class="span12 form-inline" id="mkwRow'+(idx+1)+'"><label class="span3" id="mkw_label"></label><div class="span3 no-margin-first" id="mkw_select"><select name="main_kw_ref[]" id="main_kw_ref'+(idx+1)+'" class="chzn_d" style="width:70px;"><option value="1">A</option><option value="2" selected>B</option><option value="3">C</option><option value="4">D</option><option value="5">E</option><option value="6">F</option><option value="7">G</option><option value="8">H</option><option value="9">I</option><option value="10">J</option><option value="11">K</option><option value="12">L</option><option value="13">M</option><option value="14">N</option><option value="15">O</option><option value="16">P</option><option value="17">Q</option><option value="18">R</option><option value="19">S</option><option value="20">T</option><option value="21">U</option><option value="22">V</option><option value="23">W</option><option value="24">X</option><option value="25">Y</option><option value="26">Z</option></select></div><div class="col-kw"><input type="text" name="main_kw[]" class="span3"/><span id="colkw'+(idx+1)+'"><span id="addmore_mkv" class="addmore-button"><a class="btn" onclick="addMainKwref('+(idx+1)+')"><i class="icon-plus"></i></a></span><span id="rmv_mkv" class="addmore-button"><a class="btn" onclick="rmvMainKwref('+(idx+1)+')"><i class="icon-minus"></i></a></span></span></div></div>');
    
    $(".chzn_d").chosen({
        allow_single_deselect : true,
        disable_search : true
    });
    $("#main_kw_ref"+(idx+1)).trigger("liszt:updated");
}

function rmvMainKwref(idx)
{
    idx = parseInt(idx);
    $('#mkwRow'+idx).remove();
    if(idx != 2)
        $('span#colkw'+(idx-1)).html('<span id="addmore_mkv" class="addmore-button"><a class="btn" onclick="addMainKwref('+(idx-1)+')"><i class="icon-plus"></i></a></span><span id="rmv_mkv" class="addmore-button"><a class="btn" onclick="rmvMainKwref('+(idx-1)+')"><i class="icon-minus"></i></a></span>');
    else
        $('span#colkw'+(idx-1)).html('<span id="addmore_mkv" class="addmore-button"><a class="btn" onclick="addMainKwref('+(idx-1)+')"><i class="icon-plus"></i></a></span>');
}

function addCondKwref(idx)
{
    idx = parseInt(idx);
    $('span#colcond'+idx).html('');

    $('#mcond').append('<div class="span12 form-inline" id="mcondRow'+(idx+1)+'"><label class="span3" id="mcond_label"></label><div class="span3 no-margin-first" id="mcond_select"><select name="main_cond_ref[]" id="main_cond_ref'+(idx+1)+'" class="chzn_e" style="width:70px;"><option value="1">A</option><option value="2">B</option><option value="3">C</option><option value="4" selected>D</option><option value="5">E</option><option value="6">F</option><option value="7">G</option><option value="8">H</option><option value="9">I</option><option value="10">J</option><option value="11">K</option><option value="12">L</option><option value="13">M</option><option value="14">N</option><option value="15">O</option><option value="16">P</option><option value="17">Q</option><option value="18">R</option><option value="19">S</option><option value="20">T</option><option value="21">U</option><option value="22">V</option><option value="23">W</option><option value="24">X</option><option value="25">Y</option><option value="26">Z</option></select><select name="condn[]" id="slcondn'+(idx+1)+'" style="width:130px;" class="chzn_f"><option value="1">Should contain</option><option value="2" selected>Should not contain</option></select></div><div class="col-cond"><input type="text" name="main_cond[]" class="span3"/><span id="colcond'+(idx+1)+'"><span id="addmore_mcv" class="addmore-button"><a class="btn" onclick="addCondKwref('+(idx+1)+')"><i class="icon-plus"></i></a></span><span id="rmv_mcv" class="addmore-button"><a class="btn" onclick="rmvCondKwref('+(idx+1)+')"><i class="icon-minus"></i></a></span></span></div></div>');
    
    //document.getElementById("main_cond_ref"+(idx+1)).selectedIndex = +(idx+1);
    //document.getElementById("slcondn"+(idx+1)).selectedIndex = +(idx+1);
    
    $(".chzn_e").chosen({
        allow_single_deselect : true,
        disable_search : true
    });
    $(".chzn_f").chosen({
        allow_single_deselect : true,
        disable_search : true
    });
    $("#main_cond_ref"+(idx+1)).trigger("liszt:updated");
    $("#slcondn"+(idx+1)).trigger("liszt:updated");
}

function rmvCondKwref(idx)
{
    idx = parseInt(idx);//alert(idx);
    $('#mcondRow'+idx).remove();
    if(idx != 2)
        $('span#colcond'+(idx-1)).html('<span id="addmore_mcv" class="addmore-button"><a class="btn" onclick="addCondKwref('+(idx-1)+')"><i class="icon-plus"></i></a></span><span id="rmv_mcv" class="addmore-button"><a class="btn" onclick="rmvCondKwref('+(idx-1)+')"><i class="icon-minus"></i></a></span>');
    else
        $('span#colcond'+(idx-1)).html('<span id="addmore_mcv" class="addmore-button"><a class="btn" onclick="addCondKwref('+(idx-1)+')"><i class="icon-plus"></i></a></span>');
}

	$(document).ready(function() {
	    $(".uni_style").uniform();
		gebo_chosen.init();
        	gebo_validation.reg();
	});
    
    $.validator.addMethod("csvextension", function(value, element, param) {
        param = typeof param === "string" ? param.replace(/,/g, '|') : "xls|xlsx";
        return this.optional(element) || value.match(new RegExp(".(" + param + ")$", "i"));
    }, $.format("Only xls and xlsx files are accepted."));
    
    $.validator.addMethod("validateMainKw", function(value, element, param) {
        var errFlg = true;
        $('input[name="main_kw[]"]').each(function() {
            if(($(this).val()).trim() == '')    errFlg = false ;
        });
        return errFlg;
    }, $.format("Please enter keywords."));
    
    $.validator.addMethod("validateMainCondtn", function(value, element, param) {
        var errFlg = true;
        $('input[name="main_cond[]"]').each(function() {
            if(($(this).val()).trim() == '')    errFlg = false ;
        });
        return errFlg;
    }, $.format("Please enter keywords."));
    
	//* validation
	gebo_validation = {
        reg : function() {
            reg_validator = $('.form_validation_reg').validate({
                onkeyup : false,
                errorClass : 'error',
                validClass : 'valid',
                highlight : function(element) {
                    $(element).closest('div').addClass("f_error");
                    $(element).closest('div').css("color", "black");
                },
                unhighlight : function(element) {
                    $(element).closest('div').removeClass("f_error");
                },
                submitHandler : function(element) {
                    $('#seotool-notify').show();
                },
                errorPlacement : function(error, element) {
                    $('#seotool-notify').hide();
                    $(element).closest('div').append(error);
                    $('.error').css("font-size", "10px");
                    $('.error').css("padding-top", "5px");
                },
                rules : {
                    keyword_file1 : {
                        required : true,
                        csvextension : "xls|xlsx"
                    },
                    "main_kw[]" : {
                        required : true,
                        validateMainKw : true
                    },
                    "main_cond[]" : {
                        required : true,
                        validateMainCondtn : true
                    }
                },
                messages : {
                    keyword_file1 : {
                        required : "Please select xls/xlsx file.",
                        accept : "Only xls/xlsx files are accepted."
                    },
                    "main_kw[]" : {
                        required : "Please enter keywords."
                    },
                    "main_cond[]" : {
                        required : "Please enter keywords."
                    }
                },
                invalidHandler : function(form, validator) {
                    $.sticky("There are some errors. Please corect them and submit again.", {
                        autoclose : 5000,
                        position : "top-center",
                        type : "st-error"
                    });
                }
            })
        }
	};

	gebo_chosen = {
		init : function() {
			$(".chzn_c").chosen({
				allow_single_deselect : true
			});
			$(".chzn_d").chosen({
				allow_single_deselect : true,
				disable_search : true
			});
			$(".chzn_e").chosen({
				allow_single_deselect : true,
				disable_search : true
			});
			$(".chzn_f").chosen({
				allow_single_deselect : true,
				disable_search : true
			});/**/
		}
	};

    function loadblkws(client, idx) {
        var target_page = "/seotool/loadblkws?client=" + client;
        if (client != '') {
            $.post(target_page, function(data) {
                var data = $.trim(data);
                $('#seo-message').html('');
                $('#seo-message').removeClass("alert alert-info");
                if (data != "") {
                    data = data.replace(/, /g, '\n');
                    data = data.replace(/,/g, '\n');
                    data1 = data.split('\n');
                    
                    if(idx == '')
                    {
                        $('#txtarea_sp').val(data);
                    }
                    else
                    {
                        $('#txtarea_sp1').val(data);
                    }
                    return false;
                }
                return false;
            });
            return false;
        }
        return false;
    }
</script>
<style>#cblkwtab, #blkwtab{min-height:500px;}
div[id^="mkwRow"], div[id^="mcondRow"]{margin-left:0 !important;}
#addmore_mkv,#rmv_mkv,#addmore_mcv,#rmv_mcv{padding-left:5px;}</style>
{/literal}
